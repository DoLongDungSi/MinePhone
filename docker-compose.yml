version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "5000:5000"
    volumes:
      - ./backend/app:/app/app
      - ./backend/data:/app/data
    environment:
      - DATABASE_URL=sqlite:///./data/minephone.db
      # --- CẤU HÌNH AI CHATBOT ---
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY} 
      - OPENROUTER_MODEL=${OPENROUTER_MODEL:-arcee-ai/trinity-mini:free}
      - CHATBOT_PROMPT="Bạn là nhân viên tư vấn nhiệt tình của MinePhone. Dưới đây là danh sách sản phẩm hiện có. Hãy tư vấn dựa trên dữ liệu này. Nếu không có thông tin, hãy nói khéo là chưa rõ. Luôn trả lời ngắn gọn, thân thiện bằng tiếng Việt."

  frontend:
    build: ./frontend
    container_name: minephone_ui
    ports:
      - "3000:3000"
    volumes:
      - ./frontend/src:/app/src
      - /app/node_modules
    environment:
      - VITE_API_URL=http://localhost:5000
      - CHOKIDAR_USEPOLLING=true 
    depends_on:
      - backend
    stdin_open: true
    tty: true